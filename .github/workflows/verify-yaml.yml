name: "âœ… YAML Syntax Check"

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  verify-yaml:
    name: ğŸ“ Verify YAML Syntax
    runs-on: ubuntu-latest
    timeout-minutes: 2
    
    steps:
    - name: ğŸš€ Checkout
      uses: actions/checkout@v4
    
    - name: ğŸ” Install Python YAML parser
      run: pip3 install pyyaml
    
    - name: ğŸ“„ Verify Workflow Files
      run: |
        echo "ğŸ” Verificando sintaxis YAML..."
        echo ""
        
        ERROR_COUNT=0
        
        for file in .github/workflows/*.yml; do
          echo "ğŸ“„ $file"
          
          # Check if file exists
          if [ ! -f "$file" ]; then
            echo "âŒ Archivo no encontrado"
            ERROR_COUNT=$((ERROR_COUNT + 1))
            continue
          fi
          
          # Simple line count
          LINES=$(wc -l < "$file")
          echo "   Lines: $LINES"
          
          # Check for common YAML errors
          if grep -q ":\s*#" "$file"; then
            echo "   âš ï¸  Space before comment detected"
          fi
          
          # Try to parse with Python
          if python3 -c "
import yaml, sys
try:
    with open('$file', 'r', encoding='utf-8') as f:
        yaml.safe_load(f)
    print('   âœ… YAML vÃ¡lido')
except yaml.YAMLError as e:
    print(f'   âŒ Error YAML: {e}')
    sys.exit(1)
except Exception as e:
    print(f'   âŒ Error: {e}')
    sys.exit(1)
          "; then
            echo "   âœ… Parsed successfully"
          else
            ERROR_COUNT=$((ERROR_COUNT + 1))
          fi
          
          echo ""
        done
        
        # Final report
        echo "ğŸ“Š RESULTADO:"
        if [ $ERROR_COUNT -eq 0 ]; then
          echo "ğŸ‰ Todos los archivos YAML son vÃ¡lidos"
          exit 0
        else
          echo "âŒ Se encontraron $ERROR_COUNT archivos con errores"
          exit 1
        fi
    
    - name: âœ… Success Report
      if: success()
      run: |
        echo "========================================"
        echo "âœ… YAML VERIFICATION - SUCCESS"
        echo "========================================"
        echo "All workflow files have valid YAML syntax"
        echo "Total workflows: $(ls .github/workflows/*.yml | wc -l)"
        echo "Status: âœ… READY FOR EXECUTION"
        echo "========================================"
