name: "ğŸ”’ CodeQL Security Analysis"

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]
  schedule:
    - cron: '0 0 * * 0'  # Weekly on Sunday

jobs:
  analyze:
    name: ğŸ” Analyze
    runs-on: ubuntu-latest
    permissions:
      actions: read
      contents: read
      security-events: write
    
    strategy:
      fail-fast: false
      matrix:
        language: [ 'javascript' ]
    
    steps:
    - name: ğŸš€ Checkout repository
      uses: actions/checkout@v4
    
    - name: ğŸ“Š Repository Info
      run: |
        echo "ğŸ’ IXIMI Legacy - Security Analysis"
        echo "==================================="
        echo "Repository: legacyiximi-afk/iximi-legacy"
        echo "Branch: ${{ github.ref }}"
        echo "Commit: ${{ github.sha }}"
        echo ""
        echo "ğŸ“ JavaScript files found:"
        find . -name "*.js" -type f | grep -v node_modules | head -20
        echo ""
        echo "ğŸ“ˆ Total lines of JavaScript:"
        find . -name "*.js" -type f -exec cat {} \; | wc -l
        echo "==================================="
    
    - name: âš™ï¸ Initialize CodeQL
      uses: github/codeql-action/init@v2
      with:
        languages: ${{ matrix.language }}
        queries: security-extended,security-and-quality
        
    - name: ğŸ”¨ Autobuild
      uses: github/codeql-action/autobuild@v2
      with:
        language: javascript
        
    - name: ğŸ”’ Perform CodeQL Analysis
      uses: github/codeql-action/analyze@v2
      with:
        category: "/language:${{matrix.language}}"
        
    - name: âœ… Security Report
      run: |
        echo "=========================================="
        echo "ğŸ”’ SECURITY ANALYSIS COMPLETED"
        echo "=========================================="
        echo ""
        echo "ğŸ¯ PROJECT: IXIMI Legacy"
        echo "ğŸ“ DESCRIPTION: Blockchain for indigenous textiles"
        echo "ğŸ‘¤ AUTHOR: EstefanÃ­a PÃ©rez VÃ¡zquez"
        echo "ğŸ“§ EMAIL: legacyiximi@gmail.com"
        echo ""
        echo "ğŸ“Š ANALYSIS DETAILS:"
        echo "- Language: JavaScript"
        echo "- Files analyzed: All .js files"
        echo "- Queries: security-extended, security-and-quality"
        echo "- Status: âœ… COMPLETED"
        echo ""
        echo "ğŸš€ NEXT STEPS:"
        echo "1. Check Security tab for detailed results"
        echo "2. Review any findings in Code Scanning alerts"
        echo "3. Address critical issues immediately"
        echo "4. Monitor weekly automated scans"
        echo ""
        echo "ğŸŒ LINKS:"
        echo "- Repository: https://github.com/legacyiximi-afk/iximi-legacy"
        echo "- Security: https://github.com/legacyiximi-afk/iximi-legacy/security"
        echo "- Actions: https://github.com/legacyiximi-afk/iximi-legacy/actions"
        echo "=========================================="
